<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GAC - Gestão Financeira v5.1</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        :root {
            --navy: #001f3f;
            --gold: #d4af37;
            --gold-gradient: linear-gradient(45deg, #bf953f, #fcf6ba, #b38728, #fbf5b7, #aa771c);
            --bg: #f4f7f6;
        }

        body { font-family: 'Segoe UI', Arial, sans-serif; background: var(--bg); margin: 0; color: #333; }
        
        header {
            background: var(--navy);
            color: var(--gold);
            padding: 25px;
            text-align: center;
            border-bottom: 5px solid var(--gold);
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }

        .container { width: 95%; max-width: 1200px; margin: 20px auto; background: #fff; padding: 25px; border-radius: 12px; box-shadow: 0 8px 30px rgba(0,0,0,0.1); }

        /* Dashboard */
        .dashboard { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .card { padding: 20px; border-radius: 10px; color: white; text-align: center; border: 1px solid rgba(212, 175, 55, 0.3); transition: transform 0.3s; }
        .card:hover { transform: translateY(-5px); }
        .card-in { background: linear-gradient(135deg, #1a472a, #2ecc71); }
        .card-out { background: linear-gradient(135deg, #78350f, #d4af37); }
        .card-all { background: var(--navy); }
        .card h4 { margin: 0; font-size: 11px; text-transform: uppercase; letter-spacing: 2px; }
        .card div { font-size: 24px; font-weight: bold; margin-top: 8px; }

        /* Painéis */
        .panel { 
            display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); 
            gap: 15px; background: #f8fafc; padding: 20px; border-radius: 8px; margin-bottom: 20px;
            border: 1px solid #e2e8f0;
        }
        .input-group label { display: block; font-size: 10px; font-weight: bold; color: var(--navy); margin-bottom: 5px; }
        input, select { width: 100%; padding: 10px; border: 1px solid #cbd5e1; border-radius: 6px; box-sizing: border-box; }

        .btn { 
            background: var(--gold-gradient); color: var(--navy); font-weight: bold; 
            border: none; cursor: pointer; padding: 12px; text-transform: uppercase; 
            border-radius: 6px; transition: 0.3s; width: 100%;
        }
        .btn:hover { filter: brightness(1.1); }
        .btn-pdf { background: var(--navy); color: var(--gold); border: 1px solid var(--gold); }

        /* Tabela */
        .table-res { overflow-x: auto; margin-top: 20px; }
        table { width: 100%; border-collapse: collapse; background: white; }
        th { background: var(--navy); color: var(--gold); padding: 15px; font-size: 12px; border: 1px solid #1e293b; }
        td { padding: 12px; border: 1px solid #e2e8f0; text-align: center; font-size: 14px; }
        
        .status-pago { color: #166534; font-weight: bold; background: #dcfce7; padding: 4px 8px; border-radius: 4px; }
        .status-pendente { color: #92400e; font-weight: bold; background: #fef3c7; padding: 4px 8px; border-radius: 4px; }

        .btn-action { padding: 5px 10px; cursor: pointer; font-size: 11px; margin: 0 2px; border-radius: 4px; border: 1px solid #ccc; background: #fdfdfd; }
        .btn-del { color: #dc2626; border-color: #fee2e2; }

        @media print { .no-print { display: none !important; } }
    </style>
</head>
<body>

<header>
    <h1 style="margin:0; font-size: 1.6rem;">GICÉLIO ALVES CORREIA</h1>
    <div style="font-size: 10px; letter-spacing: 4px;">CONTROLE FINANCEIRO E JURÍDICO ESTRATÉGICO</div>
</header>

<div class="container">
    <div class="dashboard no-print">
        <div class="card card-in"><h4>Recebido</h4><div id="totRec">R$ 0,00</div></div>
        <div class="card card-out"><h4>A Receber</h4><div id="totPen">R$ 0,00</div></div>
        <div class="card card-all"><h4>Total Geral</h4><div id="totGer">R$ 0,00</div></div>
    </div>

    <div class="panel no-print">
        <div class="input-group"><label>CLIENTE / PROCESSO</label><input type="text" id="cli" placeholder="Nome do Cliente"></div>
        <div class="input-group"><label>VALOR TOTAL (R$)</label><input type="text" id="val" placeholder="0,00"></div>
        <div class="input-group"><label>PARCELAS</label><input type="number" id="par" value="1" min="1"></div>
        <div class="input-group"><label>DATA INICIAL</label><input type="date" id="dat"></div>
        <div style="display:flex; align-items:flex-end;"><button class="btn" onclick="add()">LOGAR DADOS</button></div>
    </div>

    <div class="panel no-print" style="background:#fff; border-top: 3px solid var(--gold);">
        <div class="input-group" style="grid-column: span 2;"><label>BUSCA RÁPIDA</label><input type="text" id="filCli" onkeyup="draw()" placeholder="Filtrar por nome..."></div>
        <div class="input-group">
            <label>STATUS</label>
            <select id="filSta" onchange="draw()">
                <option value="">TODOS</option>
                <option value="Pago">PAGO</option>
                <option value="Pendente">PENDENTE</option>
            </select>
        </div>
        <div style="display:flex; align-items:flex-end;"><button class="btn btn-pdf" onclick="pdf()">GERAR PDF</button></div>
    </div>

    <div id="print-area" class="table-res">
        <table>
            <thead>
                <tr>
                    <th>VENCIMENTO</th>
                    <th>CLIENTE</th>
                    <th>PARCELA</th>
                    <th>VALOR</th>
                    <th>STATUS</th>
                    <th class="no-print">AÇÕES</th>
                </tr>
            </thead>
            <tbody id="tbody"></tbody>
        </table>
    </div>
</div>

<script>
    let db = JSON.parse(localStorage.getItem('gac_db')) || [];
    const money = (v) => v.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });

    function add() {
        const cli = document.getElementById('cli').value.toUpperCase().trim();
        let valRaw = document.getElementById('val').value;
        const par = parseInt(document.getElementById('par').value);
        const dat = document.getElementById('dat').value;

        // Correção de vírgula para ponto e validação numérica
        const val = parseFloat(valRaw.replace(/\./g, '').replace(',', '.'));

        if(!cli || isNaN(val) || !dat) return alert("Preencha todos os campos corretamente.");

        const vPar = val / par;
        const baseDate = new Date(dat + 'T12:00:00');

        for(let i=0; i<par; i++) {
            let d = new Date(baseDate);
            d.setMonth(baseDate.getMonth() + i);
            db.push({
                id: Date.now() + Math.random(),
                data: d.toLocaleDateString('pt-BR'),
                cli,
                par: `${i+1}/${par}`,
                val: vPar,
                status: 'Pendente'
            });
        }
        save();
        document.getElementById('cli').value = '';
        document.getElementById('val').value = '';
        alert("Dados processados com sucesso.");
    }

    function toggle(id) {
        db = db.map(r => r.id === id ? {...r, status: r.status === 'Pago' ? 'Pendente' : 'Pago'} : r);
        save();
    }

    function del(id) {
        if(confirm("Confirmar exclusão lógica do registro?")) { db = db.filter(r => r.id !== id); save(); }
    }

    function save() {
        localStorage.setItem('gac_db', JSON.stringify(db));
        draw();
    }

    function draw() {
        const fCli = document.getElementById('filCli').value.toUpperCase();
        const fSta = document.getElementById('filSta').value;
        const filtered = db.filter(r => r.cli.includes(fCli) && (fSta === "" || r.status === fSta));

        let sRec = 0, sPen = 0;
        const tbody = document.getElementById('tbody');
        tbody.innerHTML = '';

        filtered.forEach(r => {
            if(r.status === 'Pago') sRec += r.val; else sPen += r.val;
            tbody.innerHTML += `
                <tr>
                    <td>${r.data}</td>
                    <td style="text-align:left">${r.cli}</td>
                    <td>${r.par}</td>
                    <td style="font-weight:bold">${money(r.val)}</td>
                    <td><span class="${r.status === 'Pago' ? 'status-pago' : 'status-pendente'}">${r.status.toUpperCase()}</span></td>
                    <td class="no-print">
                        <button class="btn-action" onclick="toggle(${r.id})">ALT</button>
                        <button class="btn-action btn-del" onclick="del(${r.id})">DEL</button>
                    </td>
                </tr>`;
        });

        document.getElementById('totRec').innerText = money(sRec);
        document.getElementById('totPen').innerText = money(sPen);
        document.getElementById('totGer').innerText = money(sRec + sPen);
    }

    function pdf() {
        const element = document.getElementById('print-area');
        const opt = {
            margin: 10,
            filename: 'Relatorio_GAC_Financeiro.pdf',
            html2canvas: { scale: 2 },
            jsPDF: { unit: 'mm', format: 'a4', orientation: 'landscape' }
        };
        html2pdf().set(opt).from(element).save();
    }

    draw();
</script>
</body>

</html>
